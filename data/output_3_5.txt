Please reason step by step, and put your final answer within \boxed{}. Provide only one \boxed{}.
 The problem: 
For any finite set $X$, let $| X |$ denote the number of elements in $X$. Define
\[S_n = \sum | A \cap B | ,\]
where the sum is taken over all ordered pairs $(A, B)$ such that $A$ and $B$ are subsets of $\left\{ 1 , 2 , 3,  \cdots , n \right\}$ with $|A| = |B|$.
For example, $S_2 = 4$ because the sum is taken over the pairs of subsets
\[(A, B) \in \left\{ (\emptyset, \emptyset) , ( \{1\} , \{1\} ), ( \{1\} , \{2\} ) , ( \{2\} , \{1\} ) , ( \{2\} , \{2\} ) , ( \{1 , 2\} , \{1 , 2\} ) \right\} ,\]
giving $S_2 = 0 + 1 + 0 + 0 + 1 + 2 = 4$.
Let $\frac{S_{2022}}{S_{2021}} = \frac{p}{q}$, where $p$ and $q$ are relatively prime positive integers. Find the remainder when $p + q$ is divided by
1000.


To solve for \( S_n \), we start by considering the sum \( S_n = \sum |A \cap B| \) where the sum is taken over all ordered pairs \((A, B)\) such that \(A\) and \(B\) are subsets of \(\{1, 2, \ldots, n\}\) with \(|A| = |B|\). We can express \( S_n \) as follows:

\[ S_n = \sum_{k=0}^n \sum_{\substack{|A|=k \\ |B|=k}} |A \cap B|. \]

The term \( |A \cap B| \) represents the number of elements in the intersection of sets \(A\) and \(B\). For a fixed \(k\), the number of ways to choose \(A\) and \(B\) such that \(|A| = |B| = k\) is \(\binom{n}{k}^2\). For each such pair \((A, B)\), the expected size of \(A \cap B\) is the same for all choices of \(A\) and \(B\) of size \(k\). Specifically, if we fix an element \(x \in \{1, 2, \ldots, n\}\), the probability that \(x\) is in both \(A\) and \(B\) is \(\frac{\binom{n-1}{k-1}}{\binom{n}{k}} \cdot \frac{\binom{n-1}{k-1}}{\binom{n}{k}} = \frac{k(k-1)}{n(n-1)}\).

Thus, the expected value of \(|A \cap B|\) for a fixed \(k\) is \(k \cdot \frac{k}{n}\), and the contribution to \(S_n\) from this \(k\) is \(\binom{n}{k}^2 \cdot \frac{k^2}{n}\). Summing over all \(k\) from 0 to \(n\), we get:

\[ S_n = \sum_{k=0}^n \binom{n}{k}^2 \cdot \frac{k^2}{n}. \]

Using the identity \(\sum_{k=0}^n \binom{n}{k}^2 x^k = \binom{2n}{n} x^{n/2}\) for even \(n\) and \(\sum_{k=0}^n \binom{n}{k}^2 x^k = \binom{2n}{n} x^{(n-1)/2} J_{n/2}(2\sqrt{x})\) for odd \(n\) (where \(J_m\) is the Bessel function of the first kind), we can simplify to find that:

\[ S_n = \frac{n}{2} \binom{2n}{n}. \]

For \(n = 2022\), we have:

\[ S_{2022} = \frac{2022}{2} \binom{4044}{2022}, \]
and for \(n = 2021\), we have:

\[ S_{2021} = \frac{2021}{2} \binom{4042}{2021}. \]

Thus,

\[ \frac{S_{2022}}{S_{2021}} = \frac{\frac{2022}{2} \binom{4044}{2022}}{\frac{2021}{2} \binom{4042}{2021}} = \frac{2022 \binom{4044}{2022}}{2021 \binom{4042}{2021}} = \frac{2022 \cdot \frac{4044!}{2022! 2022!}}{2021 \cdot \frac{4042!}{2021! 2021!}} = \frac{2022 \cdot 4044 \cdot 4043}{2021 \cdot 2022} = \frac{4044 \cdot 4043}{2021} = 8086. \]

So, \( \frac{S_{2022}}{S_{2021}} = 8086 \), and we have \( p = 8086 \) and \( q = 1 \). The remainder when \( p + q = 8087 \) is divided by 1000 is:

\[ 8087 \mod 1000 = 87. \]

Thus, the answer is:

\[ \boxed{87}. \]

Predicted answer: N/A
Valid answer: 245