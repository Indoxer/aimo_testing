Please reason step by step, and put your final answer within \boxed{}. Provide only one \boxed{}.
 The problem: 
For any finite set $X$, let $| X |$ denote the number of elements in $X$. Define
\[S_n = \sum | A \cap B | ,\]
where the sum is taken over all ordered pairs $(A, B)$ such that $A$ and $B$ are subsets of $\left\{ 1 , 2 , 3,  \cdots , n \right\}$ with $|A| = |B|$.
For example, $S_2 = 4$ because the sum is taken over the pairs of subsets
\[(A, B) \in \left\{ (\emptyset, \emptyset) , ( \{1\} , \{1\} ), ( \{1\} , \{2\} ) , ( \{2\} , \{1\} ) , ( \{2\} , \{2\} ) , ( \{1 , 2\} , \{1 , 2\} ) \right\} ,\]
giving $S_2 = 0 + 1 + 0 + 0 + 1 + 2 = 4$.
Let $\frac{S_{2022}}{S_{2021}} = \frac{p}{q}$, where $p$ and $q$ are relatively prime positive integers. Find the remainder when $p + q$ is divided by
1000.


To solve for \( S_n \), we start by considering the sum \( S_n = \sum |A \cap B| \) over all ordered pairs \((A, B)\) where \(A\) and \(B\) are subsets of \(\{1, 2, \ldots, n\}\) with \(|A| = |B|\). Let's denote the size of \(A\) and \(B\) by \(k\), so \(|A| = |B| = k\).

The number of ways to choose two subsets \(A\) and \(B\) each of size \(k\) from a set of size \(n\) is given by \(\binom{n}{k}^2\). For each such pair \((A, B)\), the term \(|A \cap B|\) contributes to the sum \(S_n\). To find the total contribution of \(|A \cap B|\) over all pairs \((A, B)\), we need to count how many times each element of \(\{1, 2, \ldots, n\}\) appears in the intersection \(A \cap B\).

Consider a fixed element \(i \in \{1, 2, \ldots, n\}\). The number of subsets \(A\) of size \(k\) that contain \(i\) is \(\binom{n-1}{k-1}\). Similarly, the number of subsets \(B\) of size \(k\) that contain \(i\) is also \(\binom{n-1}{k-1}\). Therefore, the number of pairs \((A, B)\) such that \(i \in A \cap B\) is \(\binom{n-1}{k-1}^2\).

Since there are \(n\) elements in the set, and each element contributes \(\binom{n-1}{k-1}^2\) to the sum \(S_n\), we have:
\[
S_n = n \sum_{k=0}^n \binom{n-1}{k-1}^2.
\]
However, we need to adjust the index of summation to start from \(k=1\) instead of \(k=0\) (since \(\binom{n-1}{k-1}\) is zero for \(k=0\)):
\[
S_n = n \sum_{k=1}^n \binom{n-1}{k-1}^2 = n \sum_{j=0}^{n-1} \binom{n-1}{j}^2 = n \binom{2(n-1)}{n-1}.
\]
This follows from the identity \(\sum_{j=0}^{m} \binom{m}{j}^2 = \binom{2m}{m}\).

Now, we need to find \(S_{2022}\) and \(S_{2021}\):
\[
S_{2022} = 2022 \binom{4042}{2021}, \quad S_{2021} = 2021 \binom{4040}{2020}.
\]
We need to find the ratio \(\frac{S_{2022}}{S_{2021}}\):
\[
\frac{S_{2022}}{S_{2021}} = \frac{2022 \binom{4042}{2021}}{2021 \binom{4040}{2020}} = \frac{2022}{2021} \cdot \frac{\binom{4042}{2021}}{\binom{4040}{2020}} = \frac{2022}{2021} \cdot \frac{4042! / (2021! 2021!)}{4040! / (2020! 2020!)} = \frac{2022}{2021} \cdot \frac{4042 \cdot 4041}{2021} = \frac{2022 \cdot 4042 \cdot 4041}{2021^2} = \frac{2 \cdot 4042 \cdot 4041}{2021} = 2 \cdot 4042 = 8084.
\]
Thus, \(\frac{S_{2022}}{S_{2021}} = \frac{8084}{1}\), and \(p = 8084\) and \(q = 1\). Therefore, \(p + q = 8085\), and the remainder when \(8085\) is divided by \(1000\) is:
\[
\boxed{85}.
\]

Predicted answer: N/A
Valid answer: 245