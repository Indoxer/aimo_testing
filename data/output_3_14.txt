Please reason step by step, and put your final answer within \boxed{}. Provide only one \boxed{}.
 The problem: 
For any finite set $X$, let $| X |$ denote the number of elements in $X$. Define
\[S_n = \sum | A \cap B | ,\]
where the sum is taken over all ordered pairs $(A, B)$ such that $A$ and $B$ are subsets of $\left\{ 1 , 2 , 3,  \cdots , n \right\}$ with $|A| = |B|$.
For example, $S_2 = 4$ because the sum is taken over the pairs of subsets
\[(A, B) \in \left\{ (\emptyset, \emptyset) , ( \{1\} , \{1\} ), ( \{1\} , \{2\} ) , ( \{2\} , \{1\} ) , ( \{2\} , \{2\} ) , ( \{1 , 2\} , \{1 , 2\} ) \right\} ,\]
giving $S_2 = 0 + 1 + 0 + 0 + 1 + 2 = 4$.
Let $\frac{S_{2022}}{S_{2021}} = \frac{p}{q}$, where $p$ and $q$ are relatively prime positive integers. Find the remainder when $p + q$ is divided by
1000.


To solve for \( S_n \), we start by considering the sum \( S_n = \sum |A \cap B| \) over all ordered pairs \((A, B)\) where \(A\) and \(B\) are subsets of \(\{1, 2, \ldots, n\}\) with \(|A| = |B|\). We need to count the contribution of each element \(i\) from \(\{1, 2, \ldots, n\}\) to the sum \(S_n\).

For a fixed element \(i\), the number of subsets \(A\) containing \(i\) is \(2^{n-1}\) (since we can choose freely the other \(n-1\) elements). Similarly, the number of subsets \(B\) containing \(i\) is also \(2^{n-1}\). Therefore, the number of ordered pairs \((A, B)\) where both \(A\) and \(B\) contain \(i\) is \(2^{n-1} \times 2^{n-1} = 2^{2(n-1)}\).

Since there are \(n\) elements in the set \(\{1, 2, \ldots, n\}\), the total contribution of all elements to the sum \(S_n\) is \(n \times 2^{2(n-1)}\). Thus, we have:
\[ S_n = n \times 2^{2(n-1)}. \]

Now, we need to find \(\frac{S_{2022}}{S_{2021}}\):
\[ S_{2022} = 2022 \times 2^{2(2022-1)} = 2022 \times 2^{4042}, \]
\[ S_{2021} = 2021 \times 2^{2(2021-1)} = 2021 \times 2^{4040}. \]
Therefore,
\[ \frac{S_{2022}}{S_{2021}} = \frac{2022 \times 2^{4042}}{2021 \times 2^{4040}} = \frac{2022 \times 2^2}{2021} = \frac{2022 \times 4}{2021} = \frac{8088}{2021}. \]

The fraction \(\frac{8088}{2021}\) is already in its simplest form because 8088 and 2021 are coprime (they have no common factors other than 1). Thus, \(p = 8088\) and \(q = 2021\), and we need to find the remainder when \(p + q = 8088 + 2021 = 10109\) is divided by 1000:
\[ 10109 \mod 1000 = 109. \]

Therefore, the remainder when \(p + q\) is divided by 1000 is \(\boxed{109}\).

Predicted answer: N/A
Valid answer: 245