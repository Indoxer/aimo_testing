Please reason step by step, and put your final answer within \boxed{}. Provide only one \boxed{}.
 The problem: 
For any finite set $X$, let $| X |$ denote the number of elements in $X$. Define
\[S_n = \sum | A \cap B | ,\]
where the sum is taken over all ordered pairs $(A, B)$ such that $A$ and $B$ are subsets of $\left\{ 1 , 2 , 3,  \cdots , n \right\}$ with $|A| = |B|$.
For example, $S_2 = 4$ because the sum is taken over the pairs of subsets
\[(A, B) \in \left\{ (\emptyset, \emptyset) , ( \{1\} , \{1\} ), ( \{1\} , \{2\} ) , ( \{2\} , \{1\} ) , ( \{2\} , \{2\} ) , ( \{1 , 2\} , \{1 , 2\} ) \right\} ,\]
giving $S_2 = 0 + 1 + 0 + 0 + 1 + 2 = 4$.
Let $\frac{S_{2022}}{S_{2021}} = \frac{p}{q}$, where $p$ and $q$ are relatively prime positive integers. Find the remainder when $p + q$ is divided by
1000.


To solve for \( S_n \), we start by considering the sum \( S_n = \sum | A \cap B | \) over all ordered pairs \((A, B)\) where \(A\) and \(B\) are subsets of \(\{1, 2, \ldots, n\}\) with \(|A| = |B|\).

First, we note that the total number of subsets of \(\{1, 2, \ldots, n\}\) is \(2^n\). For a fixed subset \(A\) with \(|A| = k\), the number of ways to choose \(B\) such that \(|B| = k\) is \(\binom{n}{k}\). For each such pair \((A, B)\), the term \(|A \cap B|\) will contribute to the sum.

The key insight is that for each element \(i \in \{1, 2, \ldots, n\}\), the probability that \(i\) is in both \(A\) and \(B\) is \(\left(\frac{k}{n}\right)^2\). This is because the probability that \(i\) is in \(A\) is \(\frac{k}{n}\) and similarly for \(B\), and these events are independent. Therefore, the expected value of \(|A \cap B|\) for a fixed \(A\) of size \(k\) is \(k^2 \cdot \frac{1}{n}\).

Summing over all possible values of \(k\) from 0 to \(n\), we get:
\[
S_n = \sum_{k=0}^n \binom{n}{k} k^2 \frac{1}{n} = \frac{1}{n} \sum_{k=0}^n \binom{n}{k} k^2.
\]

We know that \(\sum_{k=0}^n \binom{n}{k} k = n \cdot 2^{n-1}\) and \(\sum_{k=0}^n \binom{n}{k} k^2 = n(n+1)2^{n-2}\). Therefore,
\[
S_n = \frac{1}{n} \cdot n(n+1)2^{n-2} = (n+1)2^{n-2}.
\]

Now, we need to find \(\frac{S_{2022}}{S_{2021}}\):
\[
\frac{S_{2022}}{S_{2021}} = \frac{2023 \cdot 2^{2020}}{2022 \cdot 2^{2020-2}} = \frac{2023 \cdot 2^2}{2022} = \frac{2023 \cdot 4}{2022} = \frac{8092}{2022} = \frac{4046}{1011}.
\]

Since 4046 and 1011 are relatively prime, we have \(p = 4046\) and \(q = 1011\). The remainder when \(p + q = 4046 + 1011 = 5057\) is divided by 1000 is:
\[
5057 \mod 1000 = 57.
\]

Thus, the answer is:
\[
\boxed{57}.
\]

Predicted answer: N/A
Valid answer: 245