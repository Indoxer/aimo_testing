Please reason step by step, and put your final answer within \boxed{}. Provide only one \boxed{}.
 The problem: 
For any finite set $X$, let $| X |$ denote the number of elements in $X$. Define
\[S_n = \sum | A \cap B | ,\]
where the sum is taken over all ordered pairs $(A, B)$ such that $A$ and $B$ are subsets of $\left\{ 1 , 2 , 3,  \cdots , n \right\}$ with $|A| = |B|$.
For example, $S_2 = 4$ because the sum is taken over the pairs of subsets
\[(A, B) \in \left\{ (\emptyset, \emptyset) , ( \{1\} , \{1\} ), ( \{1\} , \{2\} ) , ( \{2\} , \{1\} ) , ( \{2\} , \{2\} ) , ( \{1 , 2\} , \{1 , 2\} ) \right\} ,\]
giving $S_2 = 0 + 1 + 0 + 0 + 1 + 2 = 4$.
Let $\frac{S_{2022}}{S_{2021}} = \frac{p}{q}$, where $p$ and $q$ are relatively prime positive integers. Find the remainder when $p + q$ is divided by
1000.


To find \( S_n \), we start by considering the sum \( S_n = \sum |A \cap B| \) over all ordered pairs \((A, B)\) where \(A\) and \(B\) are subsets of \(\{1, 2, \ldots, n\}\) with \(|A| = |B|\).

First, we need to determine how many times each element \(i\) appears in the intersection \(A \cap B\) for a fixed \(i\). For a fixed \(i\), \(i\) can be in \(A\) in \(2^{n-1}\) ways (since there are \(2^{n-1}\) subsets of \(\{1, 2, \ldots, n\} \setminus \{i\}\)), and similarly, \(i\) can be in \(B\) in \(2^{n-1}\) ways. However, we are interested in the cases where \(i\) is in both \(A\) and \(B\). There are \(2^{n-2}\) ways to choose the remaining elements for \(A\) and \(B\) (since we have already chosen \(i\) in both sets).

Thus, for each fixed \(i\), \(i\) contributes to the sum \(|A \cap B|\) in \(2^{n-2}\) pairs. Since there are \(n\) elements in the set, the total contribution of all elements to the sum is \(n \cdot 2^{n-2}\). Since this is true for each pair \((A, B)\) and \((B, A)\) is counted separately, we need to multiply by 2, but since we are summing over ordered pairs, we do not double-count.

Therefore, the sum \(S_n\) is given by:
\[ S_n = n \cdot 2^{n-2} \cdot 2^{n-2} = n \cdot 2^{2(n-2)} = n \cdot 2^{2n-4}. \]

Now, we need to find \( \frac{S_{2022}}{S_{2021}} \):
\[ S_{2022} = 2022 \cdot 2^{2 \cdot 2022 - 4} = 2022 \cdot 2^{4040}, \]
\[ S_{2021} = 2021 \cdot 2^{2 \cdot 2021 - 4} = 2021 \cdot 2^{4042}, \]
\[ \frac{S_{2022}}{S_{2021}} = \frac{2022 \cdot 2^{4040}}{2021 \cdot 2^{4042}} = \frac{2022}{2021 \cdot 4} = \frac{1011}{2021}. \]

Since 1011 and 2021 are relatively prime, we have \( p = 1011 \) and \( q = 2021 \). We need to find the remainder when \( p + q = 1011 + 2021 = 3032 \) is divided by 1000:
\[ 3032 \mod 1000 = 32. \]

Thus, the answer is:
\[ \boxed{32}. \]

Predicted answer: N/A
Valid answer: 245