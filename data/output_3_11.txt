Please reason step by step, and put your final answer within \boxed{}. Provide only one \boxed{}.
 The problem: 
For any finite set $X$, let $| X |$ denote the number of elements in $X$. Define
\[S_n = \sum | A \cap B | ,\]
where the sum is taken over all ordered pairs $(A, B)$ such that $A$ and $B$ are subsets of $\left\{ 1 , 2 , 3,  \cdots , n \right\}$ with $|A| = |B|$.
For example, $S_2 = 4$ because the sum is taken over the pairs of subsets
\[(A, B) \in \left\{ (\emptyset, \emptyset) , ( \{1\} , \{1\} ), ( \{1\} , \{2\} ) , ( \{2\} , \{1\} ) , ( \{2\} , \{2\} ) , ( \{1 , 2\} , \{1 , 2\} ) \right\} ,\]
giving $S_2 = 0 + 1 + 0 + 0 + 1 + 2 = 4$.
Let $\frac{S_{2022}}{S_{2021}} = \frac{p}{q}$, where $p$ and $q$ are relatively prime positive integers. Find the remainder when $p + q$ is divided by
1000.


To solve for \( S_n \), we need to consider the sum of the sizes of the intersections of all pairs of subsets of \(\{1, 2, \ldots, n\}\) of the same size. Let's start by understanding the structure of the problem.

For a fixed subset \( A \) of size \( k \), there are \(\binom{n}{k}\) such subsets. For each such subset \( A \), we need to consider all subsets \( B \) of the same size \( k \). The number of such subsets \( B \) is also \(\binom{n}{k}\). The term \( |A \cap B| \) will be the size of the intersection of \( A \) and \( B \).

The key observation is that each element \( i \) in \(\{1, 2, \ldots, n\}\) can either be in \( A \), in \( B \), in both, or in neither. The probability that a specific element \( i \) is in both \( A \) and \( B \) is \(\left(\frac{k}{n}\right)^2\). Since there are \( n \) elements, the expected number of elements in \( A \cap B \) is \( n \left(\frac{k}{n}\right)^2 = \frac{k^2}{n} \). However, since we are summing over all possible subsets, we need to count this for all pairs of subsets of size \( k \).

The total number of pairs of subsets of size \( k \) is \(\binom{n}{k}^2\). Therefore, the contribution of each subset of size \( k \) to \( S_n \) is \(\frac{k^2}{n} \binom{n}{k}^2\). Summing this over all \( k \) from 0 to \( n \), we get:
\[
S_n = \sum_{k=0}^n \frac{k^2}{n} \binom{n}{k}^2.
\]

Using the identity \(\sum_{k=0}^n k \binom{n}{k} = n 2^{n-1}\) and the fact that \(\sum_{k=0}^n k^2 \binom{n}{k} = n(n+1)2^{n-2}\), we can simplify the expression for \( S_n \):
\[
S_n = \frac{n}{n} \sum_{k=0}^n k^2 \binom{n}{k} = \sum_{k=0}^n k^2 \binom{n}{k} = n(n+1)2^{n-2}.
\]

Now, we need to find \( \frac{S_{2022}}{S_{2021}} \):
\[
\frac{S_{2022}}{S_{2021}} = \frac{2022 \cdot 2023 \cdot 2^{2020}}{2021 \cdot 2022 \cdot 2^{2020-1}} = \frac{2022 \cdot 2023 \cdot 2^{2020}}{2021 \cdot 2022 \cdot 2^{2019}} = \frac{2023 \cdot 2}{2021} = \frac{4046}{2021}.
\]

Since 4046 and 2021 are relatively prime, we have \( p = 4046 \) and \( q = 2021 \). The remainder when \( p + q = 4046 + 2021 = 6067 \) is divided by 1000 is:
\[
6067 \mod 1000 = 67.
\]

Thus, the answer is:
\[
\boxed{67}.
\]

Predicted answer: N/A
Valid answer: 245